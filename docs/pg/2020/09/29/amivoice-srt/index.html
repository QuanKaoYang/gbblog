<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AmiVoiceで音声認識からSRTファイル作成まで | ITブログ @ GB</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/yakuhanjp@3.0.0/dist/css/yakuhanrp.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/mplus1p.css">
    <script data-ad-client="ca-pub-8191791677165952" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="このところ、オンライン通訳需要で弊社でも ビデオ + 字幕 を扱うことが増えてきました。
これまでは少量であったので、地道に手作業でやっていましたが、せっかくなのでSRTファイルを作って省力化してしまおうと思い立ちました。
文字起こしをする
弊社では日本語の文字起こしの下書きに、[AmiVoice Cloud Platform](https://acp.amivoi ...">
    <link rel="preload" href="/assets/css/0.styles.01fc97fe.css" as="style"><link rel="preload" href="/assets/js/app.17b2263b.js" as="script"><link rel="preload" href="/assets/js/11.b957b6e4.js" as="script"><link rel="preload" href="/assets/js/3.982ffdb8.js" as="script"><link rel="preload" href="/assets/js/53.966f3b0d.js" as="script"><link rel="preload" href="/assets/js/9.d2194e6f.js" as="script"><link rel="preload" href="/assets/js/7.435adbd5.js" as="script"><link rel="preload" href="/assets/js/8.cd0a81cc.js" as="script"><link rel="preload" href="/assets/js/6.dc540bb0.js" as="script"><link rel="prefetch" href="/assets/js/10.e960f238.js"><link rel="prefetch" href="/assets/js/12.30802e41.js"><link rel="prefetch" href="/assets/js/13.bc54f75a.js"><link rel="prefetch" href="/assets/js/14.adcee22d.js"><link rel="prefetch" href="/assets/js/15.822257ae.js"><link rel="prefetch" href="/assets/js/16.104079cc.js"><link rel="prefetch" href="/assets/js/17.abed9c97.js"><link rel="prefetch" href="/assets/js/18.f06d0e34.js"><link rel="prefetch" href="/assets/js/19.9e2dc0ff.js"><link rel="prefetch" href="/assets/js/20.d6691e76.js"><link rel="prefetch" href="/assets/js/21.8a869ad8.js"><link rel="prefetch" href="/assets/js/22.2d9e87aa.js"><link rel="prefetch" href="/assets/js/23.489b0b9c.js"><link rel="prefetch" href="/assets/js/24.65ba4f6d.js"><link rel="prefetch" href="/assets/js/25.dc7afa09.js"><link rel="prefetch" href="/assets/js/26.92adfcfe.js"><link rel="prefetch" href="/assets/js/27.08ad844e.js"><link rel="prefetch" href="/assets/js/28.89000409.js"><link rel="prefetch" href="/assets/js/29.57f69d36.js"><link rel="prefetch" href="/assets/js/30.fe9d1390.js"><link rel="prefetch" href="/assets/js/31.2e9d0b25.js"><link rel="prefetch" href="/assets/js/32.98fc94d7.js"><link rel="prefetch" href="/assets/js/33.adddf260.js"><link rel="prefetch" href="/assets/js/34.1d722137.js"><link rel="prefetch" href="/assets/js/35.7577af54.js"><link rel="prefetch" href="/assets/js/36.4f2b6452.js"><link rel="prefetch" href="/assets/js/37.410a336a.js"><link rel="prefetch" href="/assets/js/38.08bd7031.js"><link rel="prefetch" href="/assets/js/39.23e7520d.js"><link rel="prefetch" href="/assets/js/4.f2212a61.js"><link rel="prefetch" href="/assets/js/40.09409f6e.js"><link rel="prefetch" href="/assets/js/41.c985af5c.js"><link rel="prefetch" href="/assets/js/42.ca5376a6.js"><link rel="prefetch" href="/assets/js/43.dc6345ed.js"><link rel="prefetch" href="/assets/js/44.df5e337f.js"><link rel="prefetch" href="/assets/js/45.ce6173bc.js"><link rel="prefetch" href="/assets/js/46.ff108d85.js"><link rel="prefetch" href="/assets/js/47.ae9278ec.js"><link rel="prefetch" href="/assets/js/48.464b9bc8.js"><link rel="prefetch" href="/assets/js/49.12a65a49.js"><link rel="prefetch" href="/assets/js/5.8ba1599a.js"><link rel="prefetch" href="/assets/js/50.2d83e485.js"><link rel="prefetch" href="/assets/js/51.8310b5c6.js"><link rel="prefetch" href="/assets/js/52.f22d8717.js"><link rel="prefetch" href="/assets/js/54.5d68ce1f.js"><link rel="prefetch" href="/assets/js/55.dbf5ac27.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.dfe54976.js">
    <link rel="stylesheet" href="/assets/css/0.styles.01fc97fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">ITブログ @ GB </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/column/" class="nav-link">小ネタ・小技</a></li><li class="nav-item"><a href="/pg/" class="nav-link router-link-active">プログラミング</a></li><li class="nav-item"><a href="/catovis/" class="nav-link">CATOVIS</a></li><li class="nav-item"><a href="/tag/" class="nav-link">タグ一覧</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">ITブログ @ GB </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/column/" class="nav-link">小ネタ・小技</a></li><li class="mobile-nav-item"><a href="/pg/" class="nav-link router-link-active">プログラミング</a></li><li class="mobile-nav-item"><a href="/catovis/" class="nav-link">CATOVIS</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">タグ一覧</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        AmiVoiceで音声認識からSRTファイル作成まで
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">電氣羊 @ Goldenbridge</span> <span itemprop="address">   in Osaka</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-09-29T00:00:00.000Z">
      2020年09月29日
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/音声認識" data-v-42ccfcd5><span data-v-42ccfcd5>音声認識</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/SRT" data-v-42ccfcd5><span data-v-42ccfcd5>SRT</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/Python" data-v-42ccfcd5><span data-v-42ccfcd5>Python</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>このところ、オンライン通訳需要で弊社でも <strong>ビデオ + 字幕</strong> を扱うことが増えてきました。</p> <p>これまでは少量であったので、地道に手作業でやっていましたが、せっかくなのでSRTファイルを作って省力化してしまおうと思い立ちました。</p> <h2 id="文字起こしをする"><a href="#文字起こしをする" class="header-anchor">#</a> 文字起こしをする</h2> <p>弊社では日本語の文字起こしの下書きに、<a href="https://acp.amivoice.com/main/" target="_blank" rel="noopener noreferrer">AmiVoice Cloud Platform<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を使用しています。</p> <p>日本で作られたものなので、日本語に限ればやはりGoogleなどよりも精度が高いですね。</p> <p>ゼロから書くのは大変なので<a href="https://acp.amivoice.com/main/manual/%e3%82%b5%e3%83%b3%e3%83%97%e3%83%ab%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%a0/" target="_blank" rel="noopener noreferrer">サンプルプログラム<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を微調整するだけです。</p> <p>このサンプルプログラムを実行すると、音声認識されたJSONデータが取得できます。</p> <p><a href="https://acp.amivoice.com/main/manual/i-f%E4%BB%95%E6%A7%98-http%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98api%E8%A9%B3%E7%B4%B0/#response" target="_blank" rel="noopener noreferrer">返却されるJSON<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <table><thead><tr><th>キー</th> <th>キー</th> <th>キー</th> <th>説明</th></tr></thead> <tbody><tr><td>results</td> <td></td> <td></td> <td>「発話区間の認識結果」の配列</td></tr> <tr><td></td> <td>confidence</td> <td></td> <td>信頼度(0～1の値。 0:信頼度低, 1:信頼度高)</td></tr> <tr><td></td> <td>starttime</td> <td></td> <td>発話開始時間 （音声データの先頭が0）</td></tr> <tr><td></td> <td>endtime</td> <td></td> <td>発話終了時間 （音声データの先頭が0）</td></tr> <tr><td></td> <td>tags</td> <td></td> <td>未使用（空配列）</td></tr> <tr><td></td> <td>rulename</td> <td></td> <td>未使用（空文字）</td></tr> <tr><td></td> <td>text</td> <td></td> <td>認識結果テキスト</td></tr> <tr><td></td> <td>tokens</td> <td></td> <td>認識結果テキストの形態素の配列</td></tr> <tr><td></td> <td></td> <td>written</td> <td>形態素（単語）の表記</td></tr> <tr><td></td> <td></td> <td>confidence</td> <td>形態素の信頼度（認識結果の尤度）</td></tr> <tr><td></td> <td></td> <td>starttime</td> <td>形態素の開始時間 （音声データの先頭が0）</td></tr> <tr><td></td> <td></td> <td>endtime</td> <td>形態素の終了時間（音声データの先頭が0）</td></tr> <tr><td></td> <td></td> <td>spoken</td> <td>形態素の読み</td></tr> <tr><td>utteranceid</td> <td></td> <td></td> <td>認識結果情報ID  *1</td></tr> <tr><td>text</td> <td></td> <td></td> <td>「発話区間の認識結果」の全てを結合した全体の認識結果テキスト</td></tr> <tr><td>code</td> <td></td> <td></td> <td>結果を表す1文字のコード *2 <a href="https://acp.amivoice.com/main/manual/i-f%E4%BB%95%E6%A7%98-http%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98api%E8%A9%B3%E7%B4%B0/#rescode" target="_blank" rel="noopener noreferrer">JSONに含まれるcodeとmessage一覧<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を参照のこと。</td></tr> <tr><td>message</td> <td></td> <td></td> <td>エラー内容を表す文字列 *2 <a href="https://acp.amivoice.com/main/manual/i-f%E4%BB%95%E6%A7%98-http%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98api%E8%A9%B3%E7%B4%B0/#rescode" target="_blank" rel="noopener noreferrer">JSONに含まれるcodeとmessage一覧<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を参照のこと。</td></tr></tbody></table> <p>このJSONデータからtokensにあるstarttime、endtime、writtenを使ってSRT形式に整えていきます。</p> <h2 id="pythonファイルの編集"><a href="#pythonファイルの編集" class="header-anchor">#</a> Pythonファイルの編集</h2> <p>サンプルプログラムに少しだけ手を加えます。</p> <p>まずは関数の自作部分。
日曜プログラマーなので、JSONから直接変換するだけの力がなく、中間データを作ることにしました。
字幕の分割規則については、まだ微調整が必要かと思います。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 頭の整理用に中間コンテンツを作成</span>
<span class="token keyword">def</span> <span class="token function">createMidContent</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">:</span>
	sub <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
	stime <span class="token operator">=</span> <span class="token number">0</span>
	etime <span class="token operator">=</span> <span class="token number">0</span>
	subTitles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	delimiters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;、&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;。&quot;</span><span class="token punctuation">]</span>

	<span class="token keyword">for</span> token <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>
		<span class="token keyword">if</span> sub <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
			stime <span class="token operator">=</span> token<span class="token punctuation">[</span><span class="token string">&quot;starttime&quot;</span><span class="token punctuation">]</span>

        <span class="token comment"># 句読点にあたったら字幕を分ける        </span>
		<span class="token keyword">if</span> token<span class="token punctuation">[</span><span class="token string">&quot;written&quot;</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> delimiters<span class="token punctuation">:</span>
			sub <span class="token operator">+=</span> token<span class="token punctuation">[</span><span class="token string">&quot;written&quot;</span><span class="token punctuation">]</span>

		<span class="token keyword">else</span><span class="token punctuation">:</span>
			subTitles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> stime<span class="token punctuation">,</span>
				<span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> token<span class="token punctuation">[</span><span class="token string">&quot;endtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> sub
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			sub <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

        <span class="token comment"># 文字数が24文字を超えたら字幕を分ける</span>
		<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">25</span><span class="token punctuation">:</span>
			subTitles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> stime<span class="token punctuation">,</span>
				<span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> token<span class="token punctuation">[</span><span class="token string">&quot;endtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> sub
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			sub <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

	subTitles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> stime<span class="token punctuation">,</span>
		<span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> tokens<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;endtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> sub
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> subTitles


<span class="token keyword">def</span> <span class="token function">timeForSRT</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> adding<span class="token punctuation">)</span><span class="token punctuation">:</span>
	time_ <span class="token operator">=</span> time <span class="token operator">+</span> adding
	ms_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time_ <span class="token operator">%</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	time_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>time_ <span class="token operator">-</span> ms_<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	sec_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time_ <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span>
	time_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>time_ <span class="token operator">-</span> sec_<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span>
	mn_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time_ <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span>
	time_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>time_ <span class="token operator">-</span> mn_<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span>
	hr_ <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time_ <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> ms_ <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
		ms <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;00</span><span class="token interpolation"><span class="token punctuation">{</span>ms_<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
	<span class="token keyword">elif</span> ms_ <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
		ms <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;0</span><span class="token interpolation"><span class="token punctuation">{</span>ms_<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		ms <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ms_<span class="token punctuation">)</span>
			
	<span class="token keyword">if</span> sec_ <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
		sec <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;0</span><span class="token interpolation"><span class="token punctuation">{</span>sec_<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		sec <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sec_<span class="token punctuation">)</span>
			
	<span class="token keyword">if</span> mn_ <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
		mn <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;0</span><span class="token interpolation"><span class="token punctuation">{</span>mn_<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		mn <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>mn_<span class="token punctuation">)</span>
			
	<span class="token keyword">if</span> hr_ <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
		hr <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;0</span><span class="token interpolation"><span class="token punctuation">{</span>hr_<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		hr <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>hr_<span class="token punctuation">)</span>
	
	<span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>hr<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>mn<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>sec<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>ms<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>

<span class="token keyword">def</span> <span class="token function">writeSRT</span><span class="token punctuation">(</span>subTitles<span class="token punctuation">,</span> nowStr<span class="token punctuation">)</span><span class="token punctuation">:</span>
	f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>nowStr<span class="token punctuation">}</span></span><span class="token string">.srt&quot;</span></span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>subTitles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> subTitles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
			<span class="token keyword">continue</span>

		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span>

		start <span class="token operator">=</span> subTitles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">]</span>
		startStr <span class="token operator">=</span> timeForSRT<span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		end <span class="token operator">=</span> subTitles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">]</span>
		endStr <span class="token operator">=</span> timeForSRT<span class="token punctuation">(</span>end<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>startStr<span class="token punctuation">}</span></span><span class="token string"> --&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>endStr<span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span>
		
		text <span class="token operator">=</span> subTitles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span>
		
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">\n\n&quot;</span></span><span class="token punctuation">)</span>
		
	f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>次に、 <em>HrpSimpleTesterクラス</em> が最後に呼び出す <em>resultFinalizedメソッド</em> を書き換えます。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HrpSimpleTester</span><span class="token punctuation">(</span>com<span class="token punctuation">.</span>amivoice<span class="token punctuation">.</span>hrp<span class="token punctuation">.</span>HrpListener<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ~~~ 中略 ~~~</span>
    <span class="token comment"># このメソッドを書き換える</span>
    <span class="token keyword">def</span> <span class="token function">resultFinalized</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 生のJSON文字列を保存</span>
		nowStr <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&quot;%m%d%H%M&quot;</span><span class="token punctuation">)</span>
		f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;./</span><span class="token interpolation"><span class="token punctuation">{</span>nowStr<span class="token punctuation">}</span></span><span class="token string">.json&quot;</span></span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment"># テキストのみも保存</span>
		jData <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
		text <span class="token operator">=</span> jData<span class="token punctuation">[</span><span class="token string">&quot;results&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span>
		f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;./</span><span class="token interpolation"><span class="token punctuation">{</span>nowStr<span class="token punctuation">}</span></span><span class="token string">.txt&quot;</span></span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment"># SRT形式に整形</span>
		tokens <span class="token operator">=</span> jData<span class="token punctuation">[</span><span class="token string">&quot;results&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;tokens&quot;</span><span class="token punctuation">]</span>
		subTitles <span class="token operator">=</span> createMidContent<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>
		writeSRT<span class="token punctuation">(</span>subTitles<span class="token punctuation">,</span> nowStr<span class="token punctuation">)</span>
</code></pre></div><p>レスポンスは生のJSONデータ、テキストのみのデータ、SRTファイルでそれぞれ別に保存しておきます。</p> <h2 id="インポート"><a href="#インポート" class="header-anchor">#</a> インポート</h2> <p>最後に、生成されたSRTファイルを調整したり、翻訳したりして、動画編集ソフトにインポートするだけです。
Davinci Resolveであれば、メディアプールからビデオトラックにドロップするだけでした。</p> <p>これまでの手作業から、かなりの効率化を実現しました。</p> <h2 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h2> <ul><li>改めてコードをみると、write()を使っている場所に一貫性がないので、読みづらい……</li> <li>字幕の区切りが文字数と句読点のみ。時間も考慮したい</li> <li>ミリ秒 → フレームレートの変換もしたい</li> <li>AmiVoiceは5分までしか一度に認識できないので、長尺動画用に複数ファイルの結合が必須</li> <li>機械翻訳と接続もしたい！</li></ul> <p>ニューノーマル時代の字幕作成に幸あれ！</p> <h4 id="pr"><a href="#pr" class="header-anchor">#</a> PR</h4> <p>pythonで自然言語処理を始めるのに最適な本を紹介します。</p> <iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="https://rcm-fe.amazon-adsystem.com/e/cm?ref=qf_sp_asin_til&amp;t=goldenbridg09-22&amp;m=amazon&amp;o=9&amp;p=8&amp;l=as1&amp;IS1=1&amp;detail=1&amp;asins=4758921881&amp;linkId=a05bb1b9fe0a700bf8e7b90cd371c5eb&amp;bc1=000000&amp;lt1=_blank&amp;fc1=333333&amp;lc1=0066c0&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;"></iframe> <iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="https://rcm-fe.amazon-adsystem.com/e/cm?ref=qf_sp_asin_til&amp;t=goldenbridg09-22&amp;m=amazon&amp;o=9&amp;p=8&amp;l=as1&amp;IS1=1&amp;detail=1&amp;asins=B0822PPQY4&amp;linkId=b46ddb6389eb237d7ac74fb709261ac9&amp;bc1=000000&amp;lt1=_blank&amp;fc1=333333&amp;lc1=0066c0&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;"></iframe> <iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="https://rcm-fe.amazon-adsystem.com/e/cm?o=9&amp;p=12&amp;l=ur1&amp;category=audible&amp;banner=04TW4TSNDNB96FMCBT82&amp;f=ifr&amp;linkID=faa8bbe97dd893a353431f67f901efd3&amp;t=goldenbridg09-22&amp;tracking_id=goldenbridg09-22" style="width:300px;height:250px;"></iframe> <div id="linkToGB"><img src="/logo_header.png"> <p>ゴールデンブリッジでは、<br>
    翻訳・通訳・インバウンドツアー・国際会議運営など<br>
    ご用命をお待ちしております！<br>
    また、翻訳に関わるツール・ソフトウェアの開発等についてもお気軽にお声掛けください。</p> <a href="http://goldenbridge2002.com/" target="_blank">株式会社ゴールデンブリッジ　公式Webサイト</a></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#文字起こしをする" title="文字起こしをする">文字起こしをする</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#pythonファイルの編集" title="Pythonファイルの編集">Pythonファイルの編集</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#インポート" title="インポート">インポート</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#todo" title="TODO">TODO</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="http://www.goldenbridge2002.com" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe" data-v-fdbf4940><circle cx="12" cy="12" r="10" data-v-fdbf4940></circle><line x1="2" y1="12" x2="22" y2="12" data-v-fdbf4940></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" data-v-fdbf4940></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/privacy.html" class="nav-link" data-v-fdbf4940>プライバシーポリシー</a></li><li class="copyright-item" data-v-fdbf4940><a href="http://www.goldenbridge2002.com" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940>Copyright © 2020 Goldenbridge Inc.</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.17b2263b.js" defer></script><script src="/assets/js/11.b957b6e4.js" defer></script><script src="/assets/js/3.982ffdb8.js" defer></script><script src="/assets/js/53.966f3b0d.js" defer></script><script src="/assets/js/9.d2194e6f.js" defer></script><script src="/assets/js/7.435adbd5.js" defer></script><script src="/assets/js/8.cd0a81cc.js" defer></script><script src="/assets/js/6.dc540bb0.js" defer></script>
  </body>
</html>
