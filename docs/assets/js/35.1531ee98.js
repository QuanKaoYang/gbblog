(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{317:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Wordで翻訳をしていると、文単位で選択範囲を動かしたいときがあります。\nそんな時はマクロの出番。\n早速実装してみましょう。")]),t._v(" "),a("div",{staticClass:"language-vb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vb"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Option")]),t._v(" Explicit\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Sub")]),t._v(" next_sentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wdSentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sub")]),t._v("\n")])])]),a("p",[t._v("文を選択しているときに、このマクロを実行すると、次の文が選択されます。")]),t._v(" "),a("p",[t._v("ただ、何も選択していないときには「今の場所から文終わり」ではなく、「次の文の初めから終わりまで」が選択されてしまいます。\nというわけで、もう一工夫。")]),t._v(" "),a("div",{staticClass:"language-vb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vb"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Option")]),t._v(" Explicit\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Sub")]),t._v(" next_sentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v(" Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Text "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Then")]),t._v("\n    Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MoveEnd unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("wdSentence\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Else")]),t._v("\n    Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wdSentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Sub")]),t._v("\n")])])]),a("p",[t._v("何も選択されていない場合（＝テキストが空の場合）は、Rangeオブジェクトの移動ではなく、Rangeオブジェクトの終了場所を拡張するように変更しています。\nこれで「次の文を選ぶ」という操作が実現できます。")]),t._v(" "),a("h2",{attrs:{id:"マクロをショートカット化するには……"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#マクロをショートカット化するには……"}},[t._v("#")]),t._v(" マクロをショートカット化するには……")]),t._v(" "),a("p",[t._v("まずはこのnext_sentenceが入ったファイルを保存します。\n必ず "),a("strong",[t._v("「マクロ有効文書」")]),t._v(" で保存するようにしてください。\n次に「ファイル」＞「オプション」＞「リボンのユーザー設定」と進みます。\n少し分かりづらいですが、左下の「ショートカットキー：」の隣にある「ユーザー設定」ボタンを押します。\nすると、ショートカットキーの設定画面に入れます。\n左のボックスから「マクロ」を探し、右のボックスに表示される "),a("strong",[t._v("next_sentence")]),t._v(" を選択します。次に下にあるテキストボックスにカーソルを合わせたら、割り当てたいショートカットキーを押します。\nこれが他のショートカットキーと競合していなければ問題ありません。\n「割り当て」をクリックする前に、Normal.dotではなくこのdocmファイルに保存するようにしましょう。")]),t._v(" "),a("h2",{attrs:{id:"wordファイルのテンプレート化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wordファイルのテンプレート化"}},[t._v("#")]),t._v(" Wordファイルのテンプレート化")]),t._v(" "),a("p",[t._v("次に、このファイルを「マクロ有効文書」から「マクロ有効テンプレート」に作り替え、毎回Wordの起動時に読み込まれるようにします。\nまずは「ファイル」＞「名前を付けて保存」を選択し、「マクロ有効テンプレート」を選択します。\nすると、dotmファイルが\n　C:\\Users\\％USERNAME%\\Documents\\Office のカスタム テンプレート\nに保存されます。")]),t._v(" "),a("p",[t._v("次にこれを\n　C:\\Users\\％USERNAME%\\AppData\\Roaming\\Microsoft\\Word\\STARTUP\nに移動してやります。")]),t._v(" "),a("p",[t._v("最後に、Wordの開発タブを開いて、「文書テンプレート」を選択、先ほど保存したファイルを有効にすれば、Wordの起動時にマクロが読み込まれ、どのファイルでも使えるようになります。")]),t._v(" "),a("p",[t._v("ファイルの移動が面倒だ、という方は下記のPowerShellコマンドレットで処理してしまいましょう。")]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Copy-Item")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Users\\${env:USERNAME}\\Documents\\Office のカスタム テンプレート\\*.dotm"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Users\\${env:USERNAME}AppData\\Roaming\\Microsoft\\Word\\STARTUP"')]),t._v("\n")])])]),a("p",[t._v("PowerShellで環境変数のユーザー名を利用する方法は、")]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("　"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$env")]),t._v(":USERNAME\n")])])]),a("p",[t._v("とします。")]),t._v(" "),a("h3",{attrs:{id:"office-2019-365の場合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#office-2019-365の場合"}},[t._v("#")]),t._v(" Office 2019/365の場合")]),t._v(" "),a("p",[t._v("上記のフォルダはWord2016までのものです。\n2019以降は次の場所に移動しているようです。")]),t._v(" "),a("p",[t._v("調べてもなかなか情報はでてきませんが、「文書テンプレート」の追加ボタンからSTARTUPの場所が開かれます。\nファイル選択ダイアログのパス部分をクリックして、ファイルパスを控えておきましょう。")]),t._v(" "),a("h2",{attrs:{id:"もう一工夫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#もう一工夫"}},[t._v("#")]),t._v(" もう一工夫")]),t._v(" "),a("p",[t._v("さて、これでどのWordファイルでも "),a("strong",[t._v("next_sentence")]),t._v(" が呼び出せるようになりました。これなら効率も一気に向上……と残念ながらそうはいかず、図のようなエラーがでます。")]),t._v(" "),a("p",[t._v("その理由を探るために、次のような簡易マクロを組み込みます。")]),t._v(" "),a("div",{staticClass:"language-vb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vb"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Option")]),t._v(" Explicit\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Sub")]),t._v(" display_thisdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    MsgBox "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ThisDocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sub")]),t._v("\n")])])]),a("p",[t._v("ダイアログを表示して、現在のドキュメントの名前を表示させるだけの単純なマクロです。")]),t._v(" "),a("p",[t._v("もちろん、普通に実行すればこのように表示されます。")]),t._v(" "),a("p",[t._v("このマクロを同じようにマクロ有効テンプレートにして、STARTUPに保存し、Wordを再起動します。")]),t._v(" "),a("p",[t._v("そして、新規文書でAlt + F8から実行してみると……")]),t._v(" "),a("p",[t._v("ファイル名がテンプレートに！？")]),t._v(" "),a("p",[t._v("今編集中のファイル名ではなく、テンプレート名が表示されました。\nつまり、このマクロを実行しているとき、”Selection” とは今見えている文書ではなく、テンプレートファイルの選択場所を参照しにいっているんですね。")]),t._v(" "),a("p",[t._v("これを解決するために、Selectionのドキュメントを確認します。\nエディタ画面でSelectionを選んで F1 を押すのが早いでしょう。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/office/vba/api/word.global.selection",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.microsoft.com/ja-jp/office/vba/api/word.global.selection"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("この解説によると、まずSelectionはグローバルオブジェクトのプロパティだそう。\nそうすると、どうやって識別したらいいのか……")]),t._v(" "),a("p",[t._v("しかしこの説明、Selectionの説明にしては短すぎる気がします。\nそんなわけで、Selectionオブジェクトをもう少し探してみると……")]),t._v(" "),a("p",[t._v("ありました！")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/office/vba/api/word.selection",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.microsoft.com/ja-jp/office/vba/api/word.selection"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("ここでは")]),t._v(" "),a("blockquote",[a("p",[t._v("Microsoft Word はアクティブなドキュメント ウィンドウのアクティブなウィンドウ枠から選択範囲を返します。")])]),t._v(" "),a("p",[t._v("となっていますね。")]),t._v(" "),a("p",[t._v("そしてサンプルコードも載っています。")]),t._v(" "),a("div",{staticClass:"language-vb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vb"}},[a("code",[t._v("Documents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ActiveWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cutf\n")])])]),a("p",[t._v("ということは”ActiveWindow”のSelectionであることを明示してやれば解決しそうです。")]),t._v(" "),a("p",[t._v("修正後のコードがこちら")]),t._v(" "),a("div",{staticClass:"language-vb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vb"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Option")]),t._v(" Explicit\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Sub")]),t._v(" next_sentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v(" Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Text "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Then")]),t._v("\n        ActiveWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MoveEnd unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("wdSentence\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Else")]),t._v("\n        ActiveWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Selection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wdSentence"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sub")]),t._v("\n")])])]),a("p",[t._v("これを再度マクロ有効テンプレートにして保存すると……\n今度は無事成功しました！")]),t._v(" "),a("p",[t._v("いかがでしたか？\nこのマクロを応用すれば、「１つ前の文」というショートカットも作ることができます。")]),t._v(" "),a("link-to")],1)}),[],!1,null,null,null);s.default=e.exports}}]);